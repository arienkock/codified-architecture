/**
 * This file was auto-generated by scripts/generate-openapi-handlers.ts.
 * Modifications should be made in the generator or its template.
 */

import { z } from 'zod';
import { HandlerContract } from '../../handlerContract';
import * as DomainSeamTypes from '../../../domain-seam/types';
// Domain schemas are accessed via the namespace import inserted above.

const pathParamsSchema = z.object({});
const queryParamsSchema = z.object({});
const headerParamsSchema = z.object({});
const requestBodySchema = DomainSeamTypes.UserCreateRequestSchema;

const responseSchemas = {
  "201": DomainSeamTypes.UserCreateUseCaseResponseSchema,
  "400": DomainSeamTypes.ErrorResponseSchema,
  "401": DomainSeamTypes.ErrorResponseSchema,
  "403": DomainSeamTypes.ErrorResponseSchema,
  "422": DomainSeamTypes.ErrorResponseSchema,
  "500": DomainSeamTypes.ErrorResponseSchema,
} as const;

export type PostUsersHandlerPathParams = z.infer<typeof pathParamsSchema>;
export type PostUsersHandlerQueryParams = z.infer<typeof queryParamsSchema>;
export type PostUsersHandlerHeaderParams = z.infer<typeof headerParamsSchema>;
export type PostUsersHandlerRequestBody = z.infer<typeof requestBodySchema>;
export type PostUsersHandlerResponseStatus = keyof typeof responseSchemas;
export type PostUsersHandlerResponseBodies = {
  "201": z.infer<(typeof responseSchemas)["201"]>;
  "400": z.infer<(typeof responseSchemas)["400"]>;
  "401": z.infer<(typeof responseSchemas)["401"]>;
  "403": z.infer<(typeof responseSchemas)["403"]>;
  "422": z.infer<(typeof responseSchemas)["422"]>;
  "500": z.infer<(typeof responseSchemas)["500"]>;
};

// Discriminated union type for type-safe responses
export type PostUsersHandlerResponse = { status: "201"; body: PostUsersHandlerResponseBodies["201"] } | { status: "400"; body: PostUsersHandlerResponseBodies["400"] } | { status: "401"; body: PostUsersHandlerResponseBodies["401"] } | { status: "403"; body: PostUsersHandlerResponseBodies["403"] } | { status: "422"; body: PostUsersHandlerResponseBodies["422"] } | { status: "500"; body: PostUsersHandlerResponseBodies["500"] };

export const postUsersHandler: HandlerContract<
  PostUsersHandlerPathParams,
  PostUsersHandlerQueryParams,
  PostUsersHandlerHeaderParams,
  PostUsersHandlerRequestBody,
  PostUsersHandlerResponse
> = {
  method: 'POST' as const,
  path: '/users' as const,
  pathParamsSchema,
  queryParamsSchema,
  headerParamsSchema,
  requestBodySchema,
  responseSchemas,
  parsePathParams(input: unknown) {
    return pathParamsSchema.parse(input);
  },
  parseQueryParams(input: unknown) {
    return queryParamsSchema.parse(input);
  },
  parseHeaderParams(input: unknown) {
    return headerParamsSchema.parse(input);
  },
  parseRequestBody(input: unknown) {
    return requestBodySchema.parse(input);
  },
  async handle(params) {
    // Convention-based domain handler invocation
    // Domain handler should be located at: src/domain/handlers/PostUsersHandler.ts
    // and export a function named: handleRequest
    try {
      const domainHandler = await import('../../../domain/handlers/PostUsersHandler');
      const handlerFunction = domainHandler.handleRequest;
      
      if (typeof handlerFunction !== 'function') {
        throw new Error(
          `Domain handler function 'handleRequest' not found in src/domain/handlers/PostUsersHandler.ts`
        );
      }

      // Create a minimal request context
      // TODO: Populate with actual app context from request
      const requestContext = {
        app: {}
      };

      return await handlerFunction({
        pathParams: params.pathParams,
        queryParams: params.queryParams,
        headerParams: params.headerParams,
        requestBody: params.requestBody,
        requestContext,
      });
    } catch (error) {
      if ((error as NodeJS.ErrnoException).code === 'ERR_MODULE_NOT_FOUND') {
        throw new Error(
          `Domain handler not implemented. Please create: src/domain/handlers/PostUsersHandler.ts\n` +
          `with an exported function: export async function handleRequest(params) { ... }`
        );
      }
      throw error;
    }
  },
};
